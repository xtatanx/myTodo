var app=app||{};!function(){app.authClient=function(){function a(a){i.child(a.id).set({name:e,picture:f})}function b(a){d.login(a,{scope:"public_profile,email"})}function c(){return g}var d,e,f,g,h="https://the-todo-app.firebaseio.com/users",i=new Firebase(h),j=null;return d=new FirebaseSimpleLogin(i,function(b,c){b?app.router.navigate("",{trigger:!0}):c&&(e=c.displayName,f=c.thirdPartyUserData.picture.data.url,g=c.id,app.Tasks=Backbone.Firebase.Collection.extend({model:app.Task,firebase:"https://the-todo-app.firebaseio.com/users/"+c.id+"/todos"}),app.tasks=new app.Tasks,app.addTask=new app.AddTask({collection:app.tasks}),app.tasksView=new app.TasksView({collection:app.tasks}),i.once("value",function(b){j=b.hasChild(c.id),j?(app.user.set({authenticated:!0,name:e,pic:f}),app.router.navigate("/users/"+c.id,{trigger:!0})):a(c)}))}),{login:b,userId:c}}()}(window);var app=app||{};app.User=Backbone.Model.extend({defaults:{authenticated:!1,name:"",pic:""}}),app.Task=Backbone.Model.extend({defaults:{title:"An empyt task..",done:!1,visible:!0},validate:function(a){return $.trim(a.title)?void 0:"The task has no title"}});var app=app||{};app.Tasks=Backbone.Firebase.Collection.extend({model:app.Task,firebase:"https://the-todo-app.firebaseio.com/users/"+app.authClient.userId()+"/todos"});var app=app||{};app.LandingView=Backbone.View.extend({el:"body",template:_.template($("#index").html()),initialize:function(){this.render(),this.createHeader(),this.createMainLayout()},render:function(){var a=this.template();return this.$el.html(a),this},createHeader:function(){app.connectView=new app.ConnectView({model:app.user})},createMainLayout:function(){app.mainSection=new app.MainView},events:{"click .signUpBody":"triggerSignUp"},triggerSignUp:function(a){app.connectView.signUp(a)}}),app.ConnectView=Backbone.View.extend({el:"header",template:_.template($("#connect").html()),initialize:function(){this.render(),this.on("signUp",this.signUp),this.model.on("change",this.render,this)},render:function(){var a=this.template(this.model.toJSON());return this.$el.html(a),this},events:{"click .signUp":"signUp","click #login":"login"},signUp:function(a){a.preventDefault(),app.authClient.login("facebook")},login:function(){app.authClient.login("facebook")}}),app.MainView=Backbone.View.extend({tagName:"section",className:"main-content",template:_.template($("#main-section").html()),initialize:function(){this.render()},render:function(){var a=this.template();this.$el.html(a).appendTo("#main-wrapper")},destroy:function(){this.remove(),this.unbind()}}),app.AddTask=Backbone.View.extend({tagName:"section",className:"main-content",template:_.template($("#user-todos").html()),events:{"click #add":"addTask","click .filter_btn":"filterAndActive","keypress #inputTask":"updateOnEnter"},initialize:function(){this.render()},render:function(){var a=this.template();return this.$el.html(a).appendTo("#main-wrapper"),this.delegateEvents(),this},addTask:function(){var a=$("#inputTask").val();if($("#inputTask").val(""),""===$.trim(a))this.displayMessage("Todo's can not be empty");else{var b=new app.Task({title:a});this.collection.create(b)}},displayMessage:function(a){$("#inputTask").focus().attr("placeholder",a)},updateOnEnter:function(a){13===a.keyCode&&this.addTask()},filterAndActive:function(a){this.filterByActive(a),this.toggleFilter(a)},filterByActive:function(a){var b=$(a.currentTarget),c=b.parent().find(".filter_btn");c.removeClass("active"),b.addClass("active")},toggleFilter:function(a){var b=$(a.currentTarget).data("filter");switch(b){case"done":this.collection.each(function(a){a.get("done")?a.set("visible",!0):a.set("visible",!1)},this);break;case"not-done":this.collection.each(function(a){a.get("done")?a.set("visible",!1):a.set("visible",!0)},this);break;default:this.collection.each(function(a){a.set("visible",!0)},this)}},destroy:function(){this.remove(),this.unbind()}}),app.TasksView=Backbone.View.extend({el:"#tasks",initialize:function(){this._views=[],this.render(),this.collection.on("add",this.addOne,this)},render:function(){return this.collection.each(this.addOne,this),this},addOne:function(a){var b=new app.TaskView({model:a});return this._views.push(b),$("#tasks").append(b.render().el),this},destroy:function(){this.remove(),this.unbind()}}),app.TaskView=Backbone.View.extend({tagName:"li",template:_.template($("#task").html()),initialize:function(){this.model.on("change",this.render,this),this.model.on("remove",this.remove,this)},render:function(){var a=this.template(this.model.toJSON());return this.$el.html(a),this},events:{"click .checkbox":"toggleState","click .task_title":"editTask","keypress .edit":"updateOnEnter","click  .close_btn":"clear"},toggleState:function(a){$(a.target);this.model.save("done",!this.model.get("done"))},editTask:function(a){this.task=$(a.target),this.editBox=this.task.next(),this.editInput=this.editBox.find(".edit"),$(".task_title").removeClass("display__none"),$(".editBox").removeClass("edit_box__editing"),this.task.addClass("display__none"),this.editBox.addClass("edit_box__editing"),this.editInput.attr("placeholder",this.task.text()).focus()},updateOnEnter:function(a){13===a.keyCode&&this.close()},close:function(){var a=this.editInput.val();a?(this.model.save({title:a}),this.task.removeClass("display__none"),this.editBox.removeClass("edit_box__editing")):(this.task.removeClass("display__none"),this.editBox.removeClass("edit_box__editing"))},clear:function(){app.tasks.remove(this.model)},destroy:function(){this.remove(),this.unbind()}});var app=app||{};app.Router=Backbone.Router.extend({routes:{"":"landingPage","users/:id":"getTodos",users:"getTodos","sign-up":"signUp",login:"loginUser"},landingPage:function(){app.user||(app.user=new app.User),app.landingPage||(app.landingPage=new app.LandingView),app.mainSection?app.mainSection.render():app.mainSection=new app.MainView({el:"main"}),app.addTask&&app.tasksView&&(app.addTask.destroy(),app.tasksView.destroy(),_.each(app.tasksView._views,function(a){a.destroy()}))},getTodos:function(a){app.user||(app.user=new app.User),app.landingPage||(app.landingPage=new app.LandingView),app.mainSection.destroy(),(app.addTask||app.tasksView)&&(app.addTask.render(),app.tasksView.render())},signUp:function(){},loginUser:function(){}});var app=app||{};app.init=function(){this.router=new app.Router,Backbone.history.start({pushState:!0})},$(function(){app.init()});